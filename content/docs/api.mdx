---
title: API Reference
description: API routes and endpoints in LockedIn
---

# API Reference

LockedIn uses Next.js API routes for server-side functionality.

## Search API

### `GET /api/search`

Search endpoint for documentation (powered by Fumadocs).

**Endpoint**: `/api/search`

**Method**: `GET`

**Query Parameters**:
- `q` (string, required) - Search query

**Response**:
```json
{
  "data": [
    {
      "title": "Page Title",
      "url": "/docs/page",
      "content": "Page content excerpt..."
    }
  ]
}
```

**Example**:
```bash
curl "http://localhost:3000/api/search?q=getting+started"
```

**Implementation**: Uses Fumadocs search functionality to index and search documentation pages.

## Authentication Routes

### OAuth Callback

**Endpoint**: `/auth/callback`

**Method**: `GET`

**Query Parameters**:
- `code` (string) - OAuth authorization code
- `next` (string, optional) - Redirect path after authentication

**Response**: Redirects to dashboard or specified `next` path

**Flow**:
1. OAuth provider redirects to this endpoint with `code`
2. Server exchanges code for session
3. User redirected to dashboard or `next` path

**Error Handling**: Redirects to `/auth/auth-code-error` on failure

## Supabase Client Usage

While not traditional REST APIs, LockedIn uses Supabase client methods extensively:

### User Operations

```typescript
// Get current user
const { data: { user } } = await supabase.auth.getUser();

// Update user status
await supabase
  .from("users")
  .update({
    is_locked_in: true,
    locked_in_message: "Working on a feature"
  })
  .eq("id", user.id);
```

### User Search

```typescript
// Fetch all users
const { data } = await supabase
  .from("users")
  .select("*")
  .order("last_status_update", { ascending: false });
```

### Status History

```typescript
// Insert status history
await supabase
  .from("status_history")
  .insert({
    user_id: user.id,
    is_locked_in: true,
    message: "Working on a feature"
  });
```

## Server vs Client

### Server-Side Operations

Server components and API routes use the server Supabase client:

```typescript
import { createClient } from "@/lib/supabase/server";

const supabase = await createClient();
```

- Uses Next.js `cookies()` API
- Handles SSR cookie management
- Secure server-side operations

### Client-Side Operations

Client components use the browser Supabase client:

```typescript
import { createClient } from "@/lib/supabase/client";

const supabase = createClient();
```

- Browser-based client
- Handles client-side state
- Real-time updates

## Error Handling

All API operations include error handling:

```typescript
const { data, error } = await supabase
  .from("users")
  .select("*");

if (error) {
  console.error("Error:", error);
  // Handle error
}
```

## Rate Limiting

Supabase handles rate limiting automatically:
- Free tier: 500 requests per second
- Paid tiers: Higher limits available

## Authentication

All authenticated operations require:
- Valid Supabase session
- Proper RLS policies
- User authorization

## CORS

CORS is handled by Next.js and Supabase:
- Same-origin requests allowed
- OAuth redirects configured
- No additional CORS setup needed

